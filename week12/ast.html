
<script>
  var regex = /([0-9.]+)|([ ]+)|([\r\n])|(\+)|(-)|(\*)|(\/)/g

  var dictionary = ["Number", "Whitespace", "LineTerminator", "+", "-", "*", "/"];

  function* tokenize(source) {
    var result = null;
    var lastIndex = 0;

    do {
      // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec
      // 匹配到source的位置, regex需要有g/y
      lastIndex = regex.lastIndex;
      // result中如果匹配，[0], [1], [2] 按顺序
      result = regex.exec(source);
      if (!result) break;

      if (regex.lastIndex - lastIndex !== result[0].length) {
        console.log(result);
        throw new Error(`unexpected token "${source.substring(lastIndex, regex.lastIndex)}"`);
      }

      let token = {
        type: null,
        value: null
      };

      for (var i = 0; i < dictionary.length; i++) {
        if (result[i + 1])
          token.type = dictionary[i];
      }

      token.value = result[0];

      yield token;
    } while(result);

    yield { type: "EOF" };
  }

  for (let token of tokenize("1024   +  10 * 25 / 40")) {
    console.log(token);
  }
</script>
